# 推荐系统  RecommenderSystem

## 前言：

### 推荐系统的基本概念

~~~mermaid
graph LR
曝光 --> node1(点击)

node1(点击) --> 滑动到底
node1(点击) --> 点赞
node1(点击) --> 收藏
node1(点击) --> 转发

滑动到底 --> 评论
style 曝光 fill:#bbf,stroke:#f66,stroke-width:2px,color:#fff,stroke-dasharray: 10 5
~~~

#### 消费指标

- 点击率 = 点击次数 / 曝光次数
- 点赞率 = 点赞次数 / 点击次数
- 收藏率 = 收藏次数 / 点击次数
- 转发率 = 转发次数 / 点击次数
- 阅读完成率 = 滑动到底次数 / 点击次数 $\times f$(页面长度)

#### 北极星指标

- 用户规模
  - 日活用户数（DAU）、月活用户数（MAU）
- 消费
  - 人均使用推荐的时长、人均阅读笔记的数量

- 发布
  - 发布渗透率、人均发布量


#### 实验流程

~~~mermaid
graph LR
离线实验 --> 小流量AB测试 --> 全流量上线
~~~

### 推荐系统的链路

~~~mermaid
graph LR
node0([开始]) --> 召回
召回 --> 粗排
粗排 --> 精排
精排 --> 重排
重排 --> node1([结束])
~~~

**召回通道：**协同过滤、双塔模型、关注的用户、等等。

**粗排、精排：** 输入用户特征、物品特征、统计特征，经过模型预估用户行为，预估值越大说明对物品越感兴趣，多目标时多种预估值融合得到最终分数。

**重排：**做多样性抽样（比如MMR、DPP）、用规则打散相似物品、插入广告、运营推广内容，根据生态要求调整排序。

## 召回

### 基于物品的协同过滤（ItemCF）

![image-20220601132357298](D:\我的文档\python\PYTHON\RecommenderSystem\image\image-Retrieval_01_01)

**用户对物品兴趣值人为设定**：用户对物品的行为计分，点击1分，点赞1分，收藏1分，转发1分，累计计算出用户对物品的兴趣分数。

**物品之间相似度计算**：

喜欢物品$i_{1}$的用户记作集合$W_{1}$；喜欢物品$i_{2}$的用户记作集合$W_{2}$；

定义交集$V=W_{1}\cap W_{2}$。两个物品的相似度：
$$
sim\left ( i_{1},i_{2} \right )=\frac{\left|V\right|}{\sqrt{W_{1}\cdot W_{2}}}
$$

[^注]: 公式没有考虑喜欢的程度$like(user,item)$

加上用户喜欢程度$like(user,item)$计算物品相似度：
$$
sim\left ( i_{1},i_{2} \right )=\frac{\sum_{v\in V}like(v,i_{1})\cdot like(v,i_{2})}{\sqrt{\sum _{u_{1}\in W_{1}}like^{2}(u_{1},i_{1})\cdot \sum _{u_{2}\in W_{2}}like^{2}(u_{2},i_{2})}}
$$

#### 离线计算维护两个索引

**建立“用户 $\to$  物品”的索引**

- 记录每个用户最近点击、交互过的物品ID。
- 给定任意用户ID，可以找到他近期感兴趣的物品列表。

**建立“物品 $\to$  物品”的索引**

- 计算物品之间两两相似度。
- 对于每个物品，索引它最相似的k个物品。
- 给定任意物品ID，可以快速找到它最相似的K个物品。

#### 线上召回通道

1. 给定用户ID，通过“用户$\to$ 物品”索引，找到用户近期感兴趣的物品列表(last-n)。
2. 对于last-n列表中每个物品，通过“物品$\to$ 物品”索引，找到top-k相似物品。
3. 对于取回的相似物品（最多有nk个），用公式预估用户对物品的兴趣分数。
4. 返回分数最高的m个物品，作为推荐结果。

### Swing模型



### 基于用户的协同过滤（UserCF）



### 离散特征处理

1. 建立字典：把类别映射成序号。

2. 向量化：把序号映射成向量。

   - One-hot编码：把序号映射成高维稀疏向量。

   - Embedding：把序号映射成低维稠密向量。

- Embedding参数数量：$向量维度\times  类别数量 $


   - 类别数量很大时，用embedding。

     - Word embedding

     - 用户ID embedding

     - 物品ID embedding


### 矩阵补充



